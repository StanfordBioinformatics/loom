<source>
  @type  forward
  port  {{fluentd_port}}
</source>

{% if fluentd_output_plugin == 'file' %}
<match loom.**>
  @type forest
  subtype file
  remove_prefix loom
  <template>
    format single_value
    message_key log
    path /fluentd/log/${tag}
    flush_interval 60s
    append true
  </template>
</match>
{% endif %}

{% if fluentd_output_plugin == 'google_cloud' %}
<match **>
  @type google_cloud
</match>
{% endif %}

{% if fluentd_output_plugin == 'elasticsearch' %}
<match *.**>
  type copy
  <store>
    type elasticsearch
    host {{elasticsearch_container_name}}
    port 9200
    include_tag_key true
    tag_key @log_name
    logstash_format true
    flush_interval 10s
  </store>
</match>
{% endif %}

<match **>
  @type stdout
</match>
